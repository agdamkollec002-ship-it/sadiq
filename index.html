<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agdam State Socio-Economic College</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: rgba(255, 255, 255, 0.2);
            --secondary-color: rgba(255, 255, 255, 0.1);
            --accent-color: #4a90e2;
            --text-color: #2c3e50;
            --shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            --border: 1px solid rgba(255, 255, 255, 0.18);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: url('background.jpeg') no-repeat center center fixed;
            background-size: cover;
            color: var(--text-color);
            min-height: 100vh;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            backdrop-filter: blur(5px);
            z-index: -1;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Glassmorphism styles */
        .glass {
            background: var(--primary-color);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 15px;
            border: var(--border);
            box-shadow: var(--shadow);
        }

        /* Header styles */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            margin-bottom: 30px;
        }

        .header-logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .college-logo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .college-name {
            font-size: 2.5rem;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            color: var(--text-color);
        }

        .header-buttons {
            display: flex;
            gap: 15px;
        }

        .back-btn, .profile-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .back-btn {
            display: none;
        }

        .back-btn:hover, .profile-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        /* Subject navigation */
        .subject-nav {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .subject-item {
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .subject-item:hover {
            transform: translateY(-5px);
            background: var(--secondary-color);
        }

        .subject-title {
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--text-color);
        }

        .subject-modules {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
        }

        .subject-item.active .subject-modules {
            max-height: 200px;
        }

        .module-list {
            list-style: none;
            padding-top: 10px;
        }

        .module-item {
            padding: 8px 15px;
            margin: 5px 0;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
            color: var(--text-color);
        }

        .module-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .module-item.locked {
            color: rgba(44, 62, 80, 0.7);
        }

        /* Content area */
        .content-area {
            padding: 30px;
            min-height: 400px;
        }

        .content-title {
            font-size: 1.8rem;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(44, 62, 80, 0.2);
            padding-bottom: 10px;
            color: var(--text-color);
        }

        .file-list {
            list-style: none;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            transition: all 0.2s ease;
        }

        .file-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(5px);
        }

        .file-actions a {
            margin-left: 15px;
            color: var(--accent-color);
            font-size: 1.2rem;
            transition: all 0.2s ease;
        }

        .file-actions a:hover {
            color: #2980b9;
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            width: 90%;
            max-width: 500px;
            padding: 30px;
            border-radius: 15px;
            position: relative;
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.5rem;
            cursor: pointer;
            color: rgba(44, 62, 80, 0.7);
            transition: all 0.2s ease;
        }

        .close-modal:hover {
            color: var(--text-color);
        }

        .modal-title {
            font-size: 1.8rem;
            margin-bottom: 20px;
            text-align: center;
            color: var(--text-color);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-color);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid rgba(44, 62, 80, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-color);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--accent-color);
            background: rgba(255, 255, 255, 0.15);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .checkbox-group input {
            margin-right: 10px;
        }

        .checkbox-group label {
            color: var(--text-color);
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: var(--accent-color);
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            background: #3a7bc8;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        /* Personal Cabinet */
        .cabinet-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            overflow-y: auto;
        }

        .cabinet-content {
            width: 90%;
            max-width: 900px;
            margin: 30px auto;
            padding: 30px;
            border-radius: 15px;
            position: relative;
        }

        .cabinet-sections {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        .cabinet-section {
            padding: 20px;
        }

        .section-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
            border-bottom: 1px solid rgba(44, 62, 80, 0.2);
            padding-bottom: 10px;
            color: var(--text-color);
        }

        .file-edit-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
        }

        .file-edit-actions button {
            margin-left: 10px;
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .file-edit-actions button:hover {
            color: var(--accent-color);
        }

        .upload-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .module-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .module-btn {
            flex: 1;
            padding: 10px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(44, 62, 80, 0.3);
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .module-btn.active {
            background: var(--accent-color);
            border-color: var(--accent-color);
            color: white;
        }

        .upload-buttons {
            display: flex;
            gap: 15px;
        }

        .upload-btn {
            flex: 1;
            padding: 15px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px dashed rgba(44, 62, 80, 0.3);
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .upload-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: var(--accent-color);
        }

        .upload-btn i {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .file-input {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .college-name {
                font-size: 1.8rem;
            }
            
            .subject-nav {
                grid-template-columns: 1fr;
            }
            
            .upload-buttons {
                flex-direction: column;
            }
            
            .module-selector {
                flex-direction: column;
            }
            
            .header-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="glass">
            <div class="header-logo-container">
                <img src="kollec.png" alt="College Logo" class="college-logo">
                <h1 class="college-name">Ağdam Dövlət Sosial-İqtisadi Kolleci</h1>
            </div>
            <div class="header-buttons">
                <button class="back-btn" id="backBtn">
                    <i class="fas fa-arrow-left"></i> Əsas Səhifə
                </button>
                <button class="profile-btn" id="profileBtn">
                    <i class="fas fa-user"></i> Şəxsi Kabinet
                </button>
            </div>
        </header>

        <!-- Subject Navigation -->
        <div class="subject-nav" id="subjectNav">
            <div class="subject-item glass" data-subject="transport">
                <div class="subject-title" title="Nəqliyyat">
                    Nəqliyyat
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="subject-modules">
                    <ul class="module-list">
                        <li class="module-item" data-module="lecture">Mühazirə</li>
                        <li class="module-item locked" data-module="colloquium">
                            Kollekvium <i class="fas fa-lock"></i>
                        </li>
                        <li class="module-item locked" data-module="seminar">
                            Seminar <i class="fas fa-lock"></i>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="subject-item glass" data-subject="computer">
                <div class="subject-title" title="Kompyuter sistemləri, energetika və poçt rabitəsi">
                    Kompyuter sistemləri
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="subject-modules">
                    <ul class="module-list">
                        <li class="module-item" data-module="lecture">Mühazirə</li>
                        <li class="module-item locked" data-module="colloquium">
                            Kollekvium <i class="fas fa-lock"></i>
                        </li>
                        <li class="module-item locked" data-module="seminar">
                            Seminar <i class="fas fa-lock"></i>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="subject-item glass" data-subject="math">
                <div class="subject-title" title="Riyaziyyat, informatika və Fizika">
                    Riyaziyyat
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="subject-modules">
                    <ul class="module-list">
                        <li class="module-item" data-module="lecture">Mühazirə</li>
                        <li class="module-item locked" data-module="colloquium">
                            Kollekvium <i class="fas fa-lock"></i>
                        </li>
                        <li class="module-item locked" data-module="seminar">
                            Seminar <i class="fas fa-lock"></i>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="subject-item glass" data-subject="economics">
                <div class="subject-title" title="İqtisadiyyat">
                    İqtisadiyyat
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="subject-modules">
                    <ul class="module-list">
                        <li class="module-item" data-module="lecture">Mühazirə</li>
                        <li class="module-item locked" data-module="colloquium">
                            Kollekvium <i class="fas fa-lock"></i>
                        </li>
                        <li class="module-item locked" data-module="seminar">
                            Seminar <i class="fas fa-lock"></i>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="subject-item glass" data-subject="azerbaijani">
                <div class="subject-title" title="Azərbaycan dili və ədəbiyyat">
                    Azərbaycan dili
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="subject-modules">
                    <ul class="module-list">
                        <li class="module-item" data-module="lecture">Mühazirə</li>
                        <li class="module-item locked" data-module="colloquium">
                            Kollekvium <i class="fas fa-lock"></i>
                        </li>
                        <li class="module-item locked" data-module="seminar">
                            Seminar <i class="fas fa-lock"></i>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="subject-item glass" data-subject="english">
                <div class="subject-title" title="İngilis dili">
                    İngilis dili
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="subject-modules">
                    <ul class="module-list">
                        <li class="module-item" data-module="lecture">Mühazirə</li>
                        <li class="module-item locked" data-module="colloquium">
                            Kollekvium <i class="fas fa-lock"></i>
                        </li>
                        <li class="module-item locked" data-module="seminar">
                            Seminar <i class="fas fa-lock"></i>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="subject-item glass" data-subject="physical">
                <div class="subject-title" title="Fiziki tərbiyə və çağırışa hazırlıq">
                    Fiziki tərbiyə
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="subject-modules">
                    <ul class="module-list">
                        <li class="module-item" data-module="lecture">Mühazirə</li>
                        <li class="module-item locked" data-module="colloquium">
                            Kollekvium <i class="fas fa-lock"></i>
                        </li>
                        <li class="module-item locked" data-module="seminar">
                            Seminar <i class="fas fa-lock"></i>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="subject-item glass" data-subject="pedagogy">
                <div class="subject-title" title="Pedaqogika və psixologiya">
                    Pedaqogika
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="subject-modules">
                    <ul class="module-list">
                        <li class="module-item" data-module="lecture">Mühazirə</li>
                        <li class="module-item locked" data-module="colloquium">
                            Kollekvium <i class="fas fa-lock"></i>
                        </li>
                        <li class="module-item locked" data-module="seminar">
                            Seminar <i class="fas fa-lock"></i>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="subject-item glass" data-subject="agriculture">
                <div class="subject-title" title="Kənd təsərrüfatı">
                    Kənd təsərrüfatı
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="subject-modules">
                    <ul class="module-list">
                        <li class="module-item" data-module="lecture">Mühazirə</li>
                        <li class="module-item locked" data-module="colloquium">
                            Kollekvium <i class="fas fa-lock"></i>
                        </li>
                        <li class="module-item locked" data-module="seminar">
                            Seminar <i class="fas fa-lock"></i>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="subject-item glass" data-subject="history">
                <div class="subject-title" title="Tarix, coğrafiya və hüquq">
                    Tarix
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="subject-modules">
                    <ul class="module-list">
                        <li class="module-item" data-module="lecture">Mühazirə</li>
                        <li class="module-item locked" data-module="colloquium">
                            Kollekvium <i class="fas fa-lock"></i>
                        </li>
                        <li class="module-item locked" data-module="seminar">
                            Seminar <i class="fas fa-lock"></i>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Content Area -->
        <div class="content-area glass" id="contentArea">
            <h2 class="content-title" id="contentTitle">Xoş gəlmisiniz....</h2>
            <ul class="file-list" id="fileList">
                <!-- Files will be dynamically loaded here -->
            </ul>
        </div>
    </div>

    <!-- Module Login Modal -->
    <div class="modal" id="moduleLoginModal">
        <div class="modal-content glass">
            <span class="close-modal" id="closeModuleLoginModal">&times;</span>
            <h2 class="modal-title" id="moduleLoginTitle">Bölməyə Daxil Ol</h2>
            <form id="moduleLoginForm">
                <div class="form-group">
                    <label for="moduleUsername">İstifadəçi adı</label>
                    <input type="text" id="moduleUsername" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="modulePassword">Şifrə</label>
                    <input type="password" id="modulePassword" class="form-control" required>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="rememberModulePassword">
                    <label for="rememberModulePassword">Şifrəni yadda saxla</label>
                </div>
                <button type="submit" class="btn btn-primary">Daxil Ol</button>
            </form>
        </div>
    </div>

    <!-- Profile Login Modal -->
    <div class="modal" id="profileLoginModal">
        <div class="modal-content glass">
            <span class="close-modal" id="closeProfileLoginModal">&times;</span>
            <h2 class="modal-title">Şəxsi Kabinetə Giriş</h2>
            <form id="profileLoginForm">
                <div class="form-group">
                    <label for="profileUsername">İstifadəçi adı</label>
                    <input type="text" id="profileUsername" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="profilePassword">Şifrə</label>
                    <input type="password" id="profilePassword" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-primary">Daxil Ol</button>
            </form>
        </div>
    </div>

    <!-- Personal Cabinet Modal -->
    <div class="cabinet-modal" id="cabinetModal">
        <div class="cabinet-content glass">
            <span class="close-modal" id="closeCabinetModal">&times;</span>
            <h2 class="modal-title" id="cabinetTitle">Şəxsi Kabinet</h2>
            <div class="cabinet-sections">
                <div class="cabinet-section glass">
                    <h3 class="section-title">Fayl Adlarını Redaktə Et</h3>
                    <div class="file-edit-list" id="fileEditList">
                        <!-- Files for editing will be dynamically loaded here -->
                    </div>
                </div>
                
                <div class="cabinet-section glass">
                    <h3 class="section-title">Fayl Əlavə Et</h3>
                    <div class="upload-section">
                        <div class="module-selector">
                            <div class="module-btn" data-module="lecture">Mühazirə</div>
                            <div class="module-btn" data-module="colloquium">Kollekvium</div>
                            <div class="module-btn" data-module="seminar">Seminar</div>
                        </div>
                        <div class="upload-buttons">
                            <div class="upload-btn">
                                <i class="fas fa-file-pdf"></i>
                                PDF Əlavə Et
                                <input type="file" class="file-input" id="pdfUpload" accept=".pdf">
                            </div>
                            <div class="upload-btn">
                                <i class="fas fa-file-word"></i>
                                Word Əlavə Et
                                <input type="file" class="file-input" id="wordUpload" accept=".doc,.docx">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="cabinet-section glass">
                    <h3 class="section-title">Şifrəni Yenilə</h3>
                    <form id="updatePasswordForm">
                        <div class="form-group">
                            <label for="currentPassword">Hazırki Şifrə</label>
                            <input type="password" id="currentPassword" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="newPassword">Yeni Şifrə</label>
                            <input type="password" id="newPassword" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="confirmPassword">Təsdiq Et</label>
                            <input type="password" id="confirmPassword" class="form-control" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Şifrəni Yenilə</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
<script>
  const API_BASE = 'https://sadiq-tm42.onrender.com';
  
  // Məlumatları yadda saxlayan dəyişənlər
  let fileData = {};
  let teacherCredentials = {};
  let moduleCredentials = {};

  // Cari vəziyyət dəyişənləri
  let currentSubject = null;
  let currentModule = null;
  let currentTeacherSubject = null;
  let selectedModule = 'lecture';
  let lastUpdateTime = 0;

  // DOM Elementlərinə istinadlar
  const subjectItems = document.querySelectorAll('.subject-item');
  const moduleItems = document.querySelectorAll('.module-item');
  const fileList = document.getElementById('fileList');
  const moduleLoginModal = document.getElementById('moduleLoginModal');
  const profileLoginModal = document.getElementById('profileLoginModal');
  const cabinetModal = document.getElementById('cabinetModal');
  const closeModuleLoginModal = document.getElementById('closeModuleLoginModal');
  const closeProfileLoginModal = document.getElementById('closeProfileLoginModal');
  const closeCabinetModal = document.getElementById('closeCabinetModal');
  const moduleLoginForm = document.getElementById('moduleLoginForm');
  const profileLoginForm = document.getElementById('profileLoginForm');
  const backBtn = document.getElementById('backBtn');
  const profileBtn = document.getElementById('profileBtn');
  const pdfUpload = document.getElementById('pdfUpload');
  const wordUpload = document.getElementById('wordUpload');
  const updatePasswordForm = document.getElementById('updatePasswordForm');
  const fileEditList = document.getElementById('fileEditList');
  const contentTitle = document.getElementById('contentTitle');
  const cabinetTitle = document.getElementById('cabinetTitle');
  const moduleLoginTitle = document.getElementById('moduleLoginTitle');
  const moduleBtns = document.querySelectorAll('.module-btn');

  // Local storage-u təmizlə
  function clearLocalFileData() {
      localStorage.removeItem('collegeFileData');
      localStorage.removeItem('teacherCredentials');
      localStorage.removeItem('moduleCredentials');
      console.log('Local storage təmizləndi');
  }

  // Ağıllı yeniləmə sistemi
  function setupSmartUpdates() {
      setInterval(async () => {
          if (currentSubject && currentModule) {
              await checkForUpdates();
          }
      }, 10000); // 10 saniyə
  }

  async function checkForUpdates() {
      try {
          const response = await fetch(`${API_BASE}/api/status?t=${Date.now()}`);
          const status = await response.json();
          const serverTime = new Date(status.timestamp).getTime();
          
          if (serverTime > lastUpdateTime + 1000) {
              await loadModuleContent(currentSubject, currentModule, true);
              lastUpdateTime = serverTime;
          }
      } catch (error) {
          console.log('Yeniləmə yoxlanışı xətası:', error);
      }
  }

  // Ağıllı yenilə düyməsi
  function addSmartRefreshButton() {
      // Köhnə düyməni sil
      const oldBtn = document.querySelector('.refresh-btn');
      if (oldBtn) oldBtn.remove();

      const refreshBtn = document.createElement('button');
      refreshBtn.innerHTML = '<i class="fas fa-sync-alt"></i>';
      refreshBtn.className = 'refresh-btn';
      refreshBtn.title = 'Yenilə';
      refreshBtn.style.cssText = `
          position: fixed;
          bottom: 20px;
          right: 20px;
          background: var(--accent-color);
          color: white;
          border: none;
          padding: 12px;
          border-radius: 50%;
          cursor: pointer;
          z-index: 1000;
          box-shadow: 0 4px 15px rgba(0,0,0,0.2);
          width: 50px;
          height: 50px;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 1.2rem;
      `;
      
      let isRefreshing = false;
      
      refreshBtn.addEventListener('click', async () => {
          if (isRefreshing) return;
          
          isRefreshing = true;
          refreshBtn.style.opacity = '0.7';
          refreshBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
          
          if (currentSubject && currentModule) {
              await loadModuleContent(currentSubject, currentModule, true);
          } else {
              // Əgər heç bir modul seçilməyibsə, sadəcə status yoxla
              try {
                  await fetch(`${API_BASE}/api/status?t=${Date.now()}`);
              } catch (error) {
                  console.log('Status yoxlama xətası:', error);
              }
          }
          
          setTimeout(() => {
              refreshBtn.innerHTML = '<i class="fas fa-sync-alt"></i>';
              refreshBtn.style.opacity = '1';
              isRefreshing = false;
          }, 1000);
      });
      
      document.body.appendChild(refreshBtn);
  }

  // Serverdən məlumatları yükləyən funksiya
  async function loadDataFromServer() {
      try {
          const response = await fetch(`${API_BASE}/api/data?t=${Date.now()}`, {
              headers: {
                  'Cache-Control': 'no-cache',
                  'Pragma': 'no-cache'
              }
          });
          if (response.ok) {
              return await response.json();
          }
      } catch (error) {
          console.error('Serverə qoşulma xətası:', error);
      }
      return {};
  }

  // Serverdən müəllim məlumatlarını yükləyən funksiya
  async function loadTeacherCredentialsFromServer() {
      try {
          const response = await fetch(`${API_BASE}/api/teachers?t=${Date.now()}`, {
              headers: {
                  'Cache-Control': 'no-cache',
                  'Pragma': 'no-cache'
              }
          });
          if (response.ok) {
              return await response.json();
          }
      } catch (error) {
          console.error('Serverə qoşulma xətası:', error);
      }
      return {};
  }

  // Serverdən modul məlumatlarını yükləyən funksiya
  async function loadModuleCredentialsFromServer() {
      try {
          const response = await fetch(`${API_BASE}/api/modules?t=${Date.now()}`, {
              headers: {
                  'Cache-Control': 'no-cache',
                  'Pragma': 'no-cache'
              }
          });
          if (response.ok) {
              return await response.json();
          }
      } catch (error) {
          console.error('Serverə qoşulma xətası:', error);
      }
      return {};
  }

  // Səhifə yükləndikdə məlumatları serverdən yüklə
  window.addEventListener('DOMContentLoaded', async () => {
      // Local storage-u təmizlə
      clearLocalFileData();
      
      // Serverdən məlumatları yüklə
      try {
          const [files, teachers, modules] = await Promise.all([
              loadDataFromServer(),
              loadTeacherCredentialsFromServer(),
              loadModuleCredentialsFromServer()
          ]);
          
          fileData = files;
          teacherCredentials = teachers;
          moduleCredentials = modules;
          
          console.log('Məlumatlar serverdən yükləndi');
      } catch (error) {
          console.error('Məlumatlar yüklənərkən xəta:', error);
      }

      // İlk modul düyməsini aktiv et
      if (moduleBtns.length > 0) {
          moduleBtns[0].classList.add('active');
      }
      
      // Yadda saxlanılmış modul giriş məlumatlarını yoxla
      subjectItems.forEach(item => {
          const subject = item.getAttribute('data-subject');
          const savedUsername = localStorage.getItem(`${subject}_module_username`);
          const savedPassword = localStorage.getItem(`${subject}_module_password`);
          
          if (savedUsername && savedPassword) {
              const modules = item.querySelectorAll('.module-item.locked');
              modules.forEach(module => {
                  module.classList.remove('locked');
                  module.innerHTML = module.textContent;
              });
          }
      });

      // Real-time yeniləməni başlat
      setupSmartUpdates();
      addSmartRefreshButton();
  });

  // Fənn açılıb-bağlanmasını idarə edir
  subjectItems.forEach(item => {
      item.addEventListener('click', (e) => {
          subjectItems.forEach(otherItem => {
              if (otherItem !== item && otherItem.classList.contains('active')) {
                  otherItem.classList.remove('active');
              }
          });
          
          item.classList.toggle('active');
          
          if (item.classList.contains('active')) {
              currentSubject = item.getAttribute('data-subject');
          } else {
              currentSubject = null;
          }
      });
  });

  // Modul klik hadisəsi idarəedicisi
  moduleItems.forEach(item => {
      item.addEventListener('click', (e) => {
          e.stopPropagation();
          
          const moduleType = item.getAttribute('data-module');
          currentModule = moduleType;
          
          if (item.classList.contains('locked')) {
              moduleLoginTitle.textContent = `${getSubjectName(currentSubject)} - ${getModuleName(moduleType)}`;
              moduleLoginModal.style.display = 'flex';
          } else {
              loadModuleContent(currentSubject, moduleType, true);
          }
      });
  });

  // Fənn adını almaq üçün funksiya
  function getSubjectName(subject) {
      const names = {
          'transport': 'Nəqliyyat',
          'computer': 'Kompyuter sistemləri',
          'math': 'Riyaziyyat',
          'economics': 'İqtisadiyyat',
          'azerbaijani': 'Azərbaycan dili',
          'english': 'İngilis dili',
          'physical': 'Fiziki tərbiyə',
          'pedagogy': 'Pedaqogika',
          'agriculture': 'Kənd təsərrüfatı',
          'history': 'Tarix'
      };
      return names[subject] || subject;
  }

  // Modul adını almaq üçün funksiya
  function getModuleName(module) {
      const names = {
          'lecture': 'Mühazirə',
          'colloquium': 'Kollekvium',
          'seminar': 'Seminar'
      };
      return names[module] || module;
  }

  // Modul məzmununu yükləyən funksiya - YENİ VERSİYA
  async function loadModuleContent(subject, module, forceRefresh = false) {
      const subjectName = getSubjectName(subject);
      let titleText = '';
      
      switch(module) {
          case 'lecture':
              titleText = `${subjectName} - Mühazirə Materialları`;
              break;
          case 'colloquium':
              titleText = `${subjectName} - Kollekvium Materialları`;
              break;
          case 'seminar':
              titleText = `${subjectName} - Seminar Materialları`;
              break;
      }
      
      contentTitle.textContent = titleText;
      backBtn.style.display = 'block';
      fileList.innerHTML = '<li class="file-item glass">Yüklənir...</li>';
      
      try {
          const url = `${API_BASE}/api/files/${subject}/${module}?t=${Date.now()}`;
          const response = await fetch(url, {
              headers: {
                  'Cache-Control': 'no-cache',
                  'Pragma': 'no-cache'
              }
          });
          
          if (response.ok) {
              const files = await response.json();
              fileList.innerHTML = '';
              
              if (files.length === 0) {
                  const emptyMessage = document.createElement('li');
                  emptyMessage.className = 'file-item glass';
                  emptyMessage.innerHTML = `
                      <span class="file-name">Hələlik heç bir fayl yoxdur</span>
                  `;
                  fileList.appendChild(emptyMessage);
              } else {
                  files.forEach(file => {
                      const fileItem = createFileItem(file, true);
                      fileList.appendChild(fileItem);
                  });
              }
              
              // Son yeniləmə vaxtını qeyd et
              lastUpdateTime = Date.now();
          } else {
              throw new Error('Server xətası');
          }
      } catch (error) {
          console.error('Faylları yükləmə xətası:', error);
          fileList.innerHTML = '<li class="file-item glass">Xəta baş verdi. Yenidən cəhd edin.</li>';
      }
  }

  // Fayl elementi yaradan funksiya
  function createFileItem(file, fromServer) {
      const fileItem = document.createElement('li');
      fileItem.className = 'file-item glass';
      
      const fileType = file.type || (file.originalname.toLowerCase().endsWith('.pdf') ? 'pdf' : 'word');
      const fileIcon = fileType === 'word' ? 'fa-file-word' : 'fa-file-pdf';
      const fileName = file.originalname || file.name;
      const fileUrl = file.url || `${API_BASE}/uploads/${file.filename}`;
      
      const fileAction = `<a href="${fileUrl}" title="Yüklə" download="${fileName}" target="_blank"><i class="fas ${fileIcon}"></i></a>`;
      
      fileItem.innerHTML = `
          <span class="file-name">${fileName}</span>
          <div class="file-actions">
              ${fileAction}
          </div>
      `;
      
      fileItem.addEventListener('click', (e) => {
          if (!e.target.closest('.file-actions')) {
              const downloadLink = document.createElement('a');
              downloadLink.href = fileUrl;
              downloadLink.download = fileName;
              downloadLink.style.display = 'none';
              document.body.appendChild(downloadLink);
              downloadLink.click();
              document.body.removeChild(downloadLink);
          }
      });
      
      return fileItem;
  }

  // Modul giriş formunun təqdim olunması
  moduleLoginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const username = document.getElementById('moduleUsername').value;
      const password = document.getElementById('modulePassword').value;
      const rememberPassword = document.getElementById('rememberModulePassword').checked;
      
      try {
          const response = await fetch(`${API_BASE}/api/module-login`, {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                  subject: currentSubject,
                  username: username,
                  password: password
              })
          });

          if (response.ok) {
              const result = await response.json();
              
              if (result.success) {
                  if (rememberPassword) {
                      localStorage.setItem(`${currentSubject}_module_username`, username);
                      localStorage.setItem(`${currentSubject}_module_password`, password);
                  }
                  
                  unlockCurrentModule();
                  await loadModuleContent(currentSubject, currentModule, true);
                  moduleLoginModal.style.display = 'none';
                  moduleLoginForm.reset();
              } else {
                  alert('İstifadəçi adı və ya şifrə yanlışdır!');
              }
          } else {
              throw new Error('Server xətası');
          }
      } catch (error) {
          console.error('Giriş xətası:', error);
          alert('Serverə qoşula bilmədi. İnternet əlaqənizi yoxlayın.');
      }
  });

  // Cari modulu açan funksiya
  function unlockCurrentModule() {
      if (currentSubject && currentModule) {
          const subjectElement = document.querySelector(`.subject-item[data-subject="${currentSubject}"]`);
          const moduleElement = subjectElement.querySelector(`.module-item[data-module="${currentModule}"]`);
          
          moduleElement.classList.remove('locked');
          moduleElement.innerHTML = moduleElement.textContent;
      }
  }

  // Profil düyməsinə klik olunduqda
  profileBtn.addEventListener('click', () => {
      profileLoginModal.style.display = 'flex';
  });

  // Profil giriş formunun təqdim olunması
  profileLoginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const username = document.getElementById('profileUsername').value;
      const password = document.getElementById('profilePassword').value;
      
      try {
          const response = await fetch(`${API_BASE}/api/teacher-login`, {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                  username: username,
                  password: password
              })
          });

          if (response.ok) {
              const result = await response.json();
              
              if (result.success) {
                  openCabinet(result.subject);
                  profileLoginModal.style.display = 'none';
                  profileLoginForm.reset();
              } else {
                  alert('İstifadəçi adı və ya şifrə yanlışdır!');
              }
          } else {
              throw new Error('Server xətası');
          }
      } catch (error) {
          console.error('Giriş xətası:', error);
          alert('Serverə qoşula bilmədi. İnternet əlaqənizi yoxlayın.');
      }
  });

  // Şəxsi kabinet açan funksiya
  function openCabinet(subject) {
      currentTeacherSubject = subject;
      cabinetTitle.textContent = `${getSubjectName(subject)} - Şəxsi Kabinet`;
      cabinetModal.style.display = 'block';
      loadTeacherFiles(subject);
  }

  // Geri düyməsinə klik olunduqda
  backBtn.addEventListener('click', () => {
      backBtn.style.display = 'none';
      contentTitle.textContent = 'Xoş gəlmisiniz!';
      fileList.innerHTML = '';
      currentSubject = null;
      currentModule = null;
  });

  // Pəncərə bağlama düymələri
  closeModuleLoginModal.addEventListener('click', () => {
      moduleLoginModal.style.display = 'none';
  });

  closeProfileLoginModal.addEventListener('click', () => {
      profileLoginModal.style.display = 'none';
  });

  closeCabinetModal.addEventListener('click', () => {
      cabinetModal.style.display = 'none';
  });

  // Modul seçimi
  moduleBtns.forEach(btn => {
      btn.addEventListener('click', () => {
          moduleBtns.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          selectedModule = btn.getAttribute('data-module');
      });
  });

  // Fayl yükləmə
  pdfUpload.addEventListener('change', (e) => {
      handleFileUpload(e.target.files[0], 'pdf');
  });

  wordUpload.addEventListener('change', (e) => {
      handleFileUpload(e.target.files[0], 'word');
  });

  // Fayl yükləməni idarə edən funksiya
  async function handleFileUpload(file, type) {
      if (!currentTeacherSubject || !file) return;
      
      const fileName = file.name;
      const fileExtension = fileName.split('.').pop().toLowerCase();
      
      if (type === 'pdf' && fileExtension !== 'pdf') {
          alert('Zəhmət olmasa PDF fayl seçin!');
          return;
      }
      
      if (type === 'word' && !['doc', 'docx'].includes(fileExtension)) {
          alert('Zəhmət olmasa Word fayl seçin!');
          return;
      }
      
      try {
          const formData = new FormData();
          formData.append('file', file);
          formData.append('subject', currentTeacherSubject);
          formData.append('module', selectedModule);
          formData.append('type', type);
          
          const response = await fetch(`${API_BASE}/api/upload`, {
              method: 'POST',
              body: formData
          });

          if (response.ok) {
              const result = await response.json();
              
              alert(`${fileName} faylı uğurla əlavə edildi!`);
              
              // Şəxsi kabineti yenilə
              await loadTeacherFiles(currentTeacherSubject);
              
              // Əsas səhifəni də yenilə (əgər aktiv modul varsa)
              if (currentSubject && currentModule) {
                  setTimeout(() => {
                      loadModuleContent(currentSubject, currentModule, true);
                  }, 500);
              }
              
              if (type === 'pdf') {
                  pdfUpload.value = '';
              } else {
                  wordUpload.value = '';
              }
          } else {
              const errorData = await response.json();
              throw new Error(errorData.error || 'Yükləmə xətası');
          }
      } catch (error) {
          console.error('Fayl yükləmə xətası:', error);
          alert('Fayl yüklənərkən xəta baş verdi: ' + error.message);
          
          if (type === 'pdf') {
              pdfUpload.value = '';
          } else {
              wordUpload.value = '';
          }
      }
  }

  // Şifrə yeniləmə formu
  updatePasswordForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const currentPassword = document.getElementById('currentPassword').value;
      const newPassword = document.getElementById('newPassword').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      
      let currentTeacher = null;
      for (const [username, data] of Object.entries(teacherCredentials)) {
          if (data.subject === currentTeacherSubject) {
              currentTeacher = username;
              break;
          }
      }
      
      if (newPassword !== confirmPassword) {
          alert('Yeni şifrə və təsdiq şifrəsi uyğun gəlmir!');
          return;
      }
      
      try {
          const response = await fetch(`${API_BASE}/api/update-password`, {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                  teacher: currentTeacher,
                  currentPassword: currentPassword,
                  newPassword: newPassword
              })
          });

          if (response.ok) {
              const result = await response.json();
              if (result.success) {
                  alert('Şifrə uğurla yeniləndi!');
                  updatePasswordForm.reset();
              } else {
                  alert('Şifrə yeniləmə uğursuz oldu: ' + result.message);
              }
          } else {
              throw new Error('Server xətası');
          }
      } catch (error) {
          console.error('Şifrə yeniləmə xətası:', error);
          alert('Şifrə yenilənərkən xəta baş verdi.');
      }
  });

  // Müəllim fayllarını yükləyən funksiya
  async function loadTeacherFiles(subject) {
      fileEditList.innerHTML = '<div class="file-item glass">Yüklənir...</div>';
      
      try {
          const response = await fetch(`${API_BASE}/api/teacher-files/${subject}?t=${Date.now()}`, {
              headers: {
                  'Cache-Control': 'no-cache',
                  'Pragma': 'no-cache'
              }
          });
          if (response.ok) {
              const filesByModule = await response.json();
              fileEditList.innerHTML = '';
              
              Object.keys(filesByModule).forEach(module => {
                  if (filesByModule[module].length > 0) {
                      const moduleTitle = document.createElement('div');
                      moduleTitle.className = 'section-title';
                      moduleTitle.style.marginTop = '15px';
                      moduleTitle.style.fontSize = '1.2rem';
                      
                      switch(module) {
                          case 'lecture':
                              moduleTitle.textContent = 'Mühazirə Faylları';
                              break;
                          case 'colloquium':
                              moduleTitle.textContent = 'Kollekvium Faylları';
                              break;
                          case 'seminar':
                              moduleTitle.textContent = 'Seminar Faylları';
                              break;
                      }
                      
                      fileEditList.appendChild(moduleTitle);
                      
                      filesByModule[module].forEach(file => {
                          const fileEditItem = document.createElement('div');
                          fileEditItem.className = 'file-edit-item';
                          fileEditItem.innerHTML = `
                              <span class="file-name">${file.originalname}</span>
                              <div class="file-edit-actions">
                                  <button class="edit-btn" data-id="${file.id}" data-module="${module}"><i class="fas fa-edit"></i></button>
                                  <button class="delete-btn" data-id="${file.id}" data-module="${module}"><i class="fas fa-trash"></i></button>
                              </div>
                          `;
                          fileEditList.appendChild(fileEditItem);
                      });
                  }
              });
              
              // Əgər heç bir fayl yoxdursa
              if (fileEditList.innerHTML === '') {
                  fileEditList.innerHTML = '<div class="file-item glass">Hələlik heç bir fayl yoxdur</div>';
              }
          } else {
              throw new Error('Server xətası');
          }
      } catch (error) {
          console.error('Faylları yükləmə xətası:', error);
          fileEditList.innerHTML = '<div class="file-item glass">Xəta baş verdi. Yenidən cəhd edin.</div>';
          return;
      }
      
      // Redaktə və silmə düymələri
      document.querySelectorAll('.edit-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
              const fileId = e.currentTarget.getAttribute('data-id');
              const module = e.currentTarget.getAttribute('data-module');
              editFileName(fileId, module, subject);
          });
      });
      
      document.querySelectorAll('.delete-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
              const fileId = e.currentTarget.getAttribute('data-id');
              const module = e.currentTarget.getAttribute('data-module');
              deleteFile(fileId, module, subject);
          });
      });
  }

  // Fayl adını redaktə edən funksiya
  async function editFileName(fileId, module, subject) {
      const currentFile = data.files[subject]?.[module]?.find(f => f.id === fileId);
      if (!currentFile) {
          alert('Fayl tapılmadı!');
          return;
      }
      
      const newName = prompt('Fayl adını dəyişin:', currentFile.originalname);
      if (!newName || newName === currentFile.originalname) return;
      
      try {
          const response = await fetch(`${API_BASE}/api/update-filename`, {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                  fileId: fileId,
                  module: module,
                  subject: subject,
                  newName: newName
              })
          });

          if (response.ok) {
              const result = await response.json();
              if (result.success) {
                  await loadTeacherFiles(subject);
                  alert('Fayl adı uğurla dəyişdirildi!');
              } else {
                  alert('Fayl adı dəyişdirilərkən xəta baş verdi: ' + result.message);
              }
          } else {
              throw new Error('Server xətası');
          }
      } catch (error) {
          console.error('Ad dəyişmə xətası:', error);
          alert('Fayl adı dəyişdirilərkən xəta baş verdi.');
      }
  }

  // Faylı silən funksiya
  async function deleteFile(fileId, module, subject) {
      if (!confirm('Bu faylı silmək istədiyinizə əminsiniz?')) return;
      
      try {
          const response = await fetch(`${API_BASE}/api/delete-file`, {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                  fileId: fileId,
                  module: module,
                  subject: subject
              })
          });

          if (response.ok) {
              const result = await response.json();
              if (result.success) {
                  await loadTeacherFiles(subject);
                  
                  // Əsas səhifəni də yenilə
                  if (currentSubject === subject && currentModule === module) {
                      await loadModuleContent(subject, module, true);
                  }
                  
                  alert('Fayl uğurla silindi!');
              } else {
                  alert('Fayl silinərkən xəta baş verdi: ' + result.message);
              }
          } else {
              throw new Error('Server xətası');
          }
      } catch (error) {
          console.error('Silinmə xətası:', error);
          alert('Fayl silinərkən xəta baş verdi.');
      }
  }
</script>
</body>
</html>


